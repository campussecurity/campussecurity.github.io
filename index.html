<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
	<title>CS171 Final Project</title>
	<!-- Common CSS/JSS are incorporated into bootstrap.min.css -->
	<link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
	<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>										
</head>

<body>
	<div class="container">	
		<!--row1: Site Name-->
		<header class="row " >
		</header>
				
		<!--row2: navigation -->
		<nav class=" row navbar navbar-default " role="navigation">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#collapse">
				    <span class="sr-only">Toggle navigation</span>
				    <span class="icon-bar"></span>
				    <span class="icon-bar"></span>
				    <span class="icon-bar"></span>
				</button>
			</div>
			<div class="collapse navbar-collapse" id="collapse">
				<ul class="nav navbar-nav">
					<li><a href='index.html'>Home</a></li>
					<li><a href='http://github.com/campussecurity/campussecurity.github.io'>Code Source</a></li>
					<li><a href='/doc/PressBook.md'>PressBook</a></li>
				</ul>
			</div>
		</nav>
		<div class="row panel-info-darken edge-height">
			<main class="col-md-8 col-sm-12  panel-info-darken" >				
				<div class="col-md-12 col-sm-12 panel panel-info">	
					<div class="col-md-6 col-sm-6 panel-calm main-top" id="map-control-1">
						<h2>Map Control Panel 1</h2>

					</div>
					<div class="col-md-3 col-sm-3 panel-calm main-top" id="map-control-2">	
						<h2>Map Control Panel 2</h2>
					</div>
					<div class="col-md-3 col-sm-3 panel-calm main-top" id="map-control-3">	
						<h2>Map Control Panel 3</h2>
					</div>
					<div class="col-md-12 col-sm-12 panel-calm main-center" id="map">	
				
					</div>					
				</div>							
			</main>

			<aside class="col-md-4 col-sm-12 panel-info-darken">								
				<div class="col-md-12 col-sm-7 panel panel-info aside-center" id="box1">
                    <div>Murd:</div><input id="murdId" type="number" min="0" max="100" value="100">
                    <div>Neg:</div><input id="negId" type="number" min="0" max="100" value="10">
                    <div>Forcib:</div><input id="forcibId" type="number" min="0" max="100"  value="10">
                    <div>Non-Forcib:</div><input id="nonForcibId" type="number" min="0" max="100"  value="10">
                    <div>Robbe:</div><input id="robbeId" type="number" min="0" max="100"  value="20">
                    <div>Burg:</div><input id="burgId" type="number" min="0" max="100"  value="25">
                    <div>Vehic:</div><input id="vehicId" type="number" min="0" max="100"  value="15">
				</div>
				<div class="col-md-12 col-sm-5 panel panel-info aside-top" id="box2">
					<h1>box2</h1>
				</div>
				<div class="col-md-12  col-sm-5 panel panel-info aside-bottom" id="video">
					<h1>Video</h1>
				</div>				
		 	</aside>
		 	<section class="col-md-12 col-sm-12 panel-info-darken">
		 		<div class="col-md-12  panel panel-info aside-bottom" id="box3">
					<h1>box3</h1>
				</div>
		 	</section>
		</div>
			
		<footer class="edge-width">
			<a href="home.html">Home</a>|<a href="">About</a>|<a href=''>Contact</a>|
		</footer>
	</div> 
	<script type="text/javascript">

    var txt;



      // get the width of a D3 element
    var w = $("#map").width();
    var mapRatio = 0.6;
    var h = w*mapRatio;

    var xOffset = 0, yOffset =0, scale =1.3* w;

    var projection = d3.geo.albersUsa()
            .translate([w/2, h/2]).scale([1.3*w]);

    var drag = d3.behavior.drag()
            .on("drag", dragMove);


    var path = d3.geo.path().projection(projection);
    var paths = null;
    var svg = d3.select("#map")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

    svg.call(d3.behavior.zoom().scaleExtent([1, 1.3*w]).on("zoom", zoom));
    svg.call(drag);
    $( window ).resize(function() {
        svg.call(resize);
    });

    var colors = d3.scale.category20();

    //for counties data, see view-source:http://upload.wikimedia.org/wikipedia/commons/5/59/Usa_counties_large.svg

    //Load in GeoJSON data
    d3.json("data/us-states.json", function(json) {

        d3.tsv("data/universities.tsv", function (err,cityData) {

            var selectedData = []
            json.features.forEach(function(d){
                if(d.properties.name != "1California"){
                    selectedData.push(d);
                }
            })
            //Bind data and create one path per GeoJSON feature
            paths = svg.selectAll("path")
                    .data(selectedData)
                    .enter()
                    .append("path")
                    .attr("i",function(d,i){return i })
                    //.style("fill", function(d, i) {return colors(i)})
                    .style("stroke", "grey")
                    .attr("d", path)
                    .on("mouseover", stateIn)
                    .on("mouseout", stateOut)


            svg.selectAll("circle")
                    .data(cityData)
                    .enter()
                    .append("circle")
                    .attr("city", function(d){return d.CITY})
                    .attr("cx", function(d) {
                        var proj = projection([d.LONGITUDE, d.LATITUDE]);
                        if(!proj){
                            console.log("Invalid lat /long",d);
                            return null;
                        }
                        else {
                            return projection([d.LONGITUDE, d.LATITUDE])[0];
                        }

                    })
                    .attr("cy", function(d) {
                        var proj = projection([d.LONGITUDE, d.LATITUDE]);
                        if(!proj){
                            console.log("Invalid lat /long",d);
                            return null;
                        }
                        else {
                            return proj[1];
                        }
                    })
                    .attr("r", 1)
                    .style("fill", "red")
                    .style("opacity", 3)
                    .on('mouseover',showCityData)

            txt = svg.append("text").style("visibility", "hidden")

        });


    });
	

    function showCityData(){
        var circle = d3.select(this);

        txt.style("visibility", "visible")
                .transition()
                .delay(100)
                .text(circle.attr("city"))
                .attr("x", circle.attr("cx")+5)
                .attr("y", circle.attr("cy") +5)

    }

    function moveMap(){
        //txt.style("visibility", "hidden")
        projection.scale([scale])
                .translate([w/2 + parseInt(xOffset) ,h/2 + parseInt(yOffset)]);
        path.projection(projection)
        paths.attr("d",path)

        svg.selectAll("circle")
                .attr("cx", function(d) {
                    return projection([d.LONGITUDE, d.LATITUDE])[0];
                })
                .attr("cy", function(d) {
                    return projection([d.LONGITUDE, d.LATITUDE])[1];
                })

    }

    function zoom(){
        scale =   parseFloat(d3.event.scale)*w;
        moveMap();
    }

    function dragMove(){

        xOffset += parseFloat(d3.event.dx);
        yOffset += parseFloat(d3.event.dy);
        moveMap();
    }

    function stateIn(){
        d3.select(this).style("opacity",".6");
    }

    function stateOut(){
        var ctrl = d3.select(this);
        var i=ctrl.attr("i");
        //d3.select(this).style("fill",colors(i));
        d3.select(this).style("opacity","1");
    }
    function resize(){

        // get the width of a D3 element
        w = $("#map").width();
        h = w*mapRatio;
        scale =1.3* w;
        svg.attr("width", w)
            .attr("height", h);
        moveMap();
    }
	
</script>
</body>
</html>